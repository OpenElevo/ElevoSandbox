# Elevo Workspace Server Configuration
# Copy this file to .env and modify as needed

# ============================================================================
# Server Configuration
# ============================================================================

# HTTP Server
WORKSPACE_HTTP_HOST=0.0.0.0
WORKSPACE_HTTP_PORT=8080

# gRPC Server (for Agent connections)
WORKSPACE_GRPC_HOST=0.0.0.0
WORKSPACE_GRPC_PORT=9090

# Database
WORKSPACE_DATABASE_URL=sqlite:data/workspace.db?mode=rwc

# ============================================================================
# Docker Configuration
# ============================================================================

# Docker socket path
WORKSPACE_DOCKER_SOCKET=/var/run/docker.sock

# Default base image for sandboxes
WORKSPACE_BASE_IMAGE=workspace-base:latest

# Docker network for sandbox containers (optional)
# If not set, uses "bridge" network
# WORKSPACE_DOCKER_NETWORK=workspace-net

# Extra hosts to add to sandbox containers (comma-separated)
# This is needed for sandbox containers to connect back to the server
# Example: host.docker.internal:host-gateway
WORKSPACE_SANDBOX_EXTRA_HOSTS=host.docker.internal:host-gateway

# ============================================================================
# Workspace Storage Configuration
# ============================================================================

# Path where workspace directories are stored (inside server container)
WORKSPACE_WORKSPACE_DIR=/var/lib/workspace

# Host path for workspace directories (for Docker-in-Docker scenarios)
# When server runs in Docker, sandbox containers need to mount volumes
# from the HOST machine, not from the server container.
# This should be the host path that maps to WORKSPACE_WORKSPACE_DIR
# Example: If you mount /host/path:/var/lib/workspace in docker-compose,
# then set WORKSPACE_WORKSPACE_HOST_DIR=/host/path
# WORKSPACE_WORKSPACE_HOST_DIR=/var/lib/elevo-workspace/workspaces

# ============================================================================
# Agent Configuration
# ============================================================================

# Server address for agents to connect to (from inside sandbox containers)
# This address must be reachable from sandbox containers.
# Options:
#   - For local development: http://localhost:9090 (only works if server runs on host)
#   - For Docker: http://host.docker.internal:9090 (with extra_hosts configured)
#   - For Docker bridge: http://172.17.0.1:9090 (Linux default Docker bridge IP)
#   - For custom network: http://workspace-server:9090 (if using named container)
WORKSPACE_AGENT_SERVER_ADDR=http://172.17.0.1:9090

# Agent connection timeout in seconds
WORKSPACE_AGENT_TIMEOUT=30

# ============================================================================
# NFS Configuration
# ============================================================================

# NFS mode: "embedded" or "system"
# - embedded: Use built-in NFS server (nfsserve crate)
# - system: Use system NFS server (nfs-kernel-server)
WORKSPACE_NFS_MODE=embedded

# NFS port (for embedded mode)
WORKSPACE_NFS_PORT=2049

# ============================================================================
# Sandbox Lifecycle
# ============================================================================

# Maximum sandbox idle time in seconds (auto-cleanup after idle)
WORKSPACE_MAX_IDLE_TIME=3600

# ============================================================================
# MCP Server Configuration
# ============================================================================

# MCP Server Mode: "disabled", "stdio", or "http"
# - disabled: MCP server not started (default for development)
# - stdio: Run MCP server via stdin/stdout (for local AI assistant integration)
# - http: Run MCP server via HTTP/SSE (for network access, recommended for production)
WORKSPACE_MCP_MODE=http

# MCP HTTP endpoint path prefix (when mcp_mode is "http")
# Three endpoints will be available:
#   - {MCP_PATH}/executor   - 1 tool (process_run only)
#   - {MCP_PATH}/developer  - 6 tools (process + file operations)
#   - {MCP_PATH}/full       - 14 tools (all operations)
WORKSPACE_MCP_PATH=/mcp

# MCP Profile (only used for stdio mode): "executor", "developer", or "full"
# Determines which tools are available to the AI:
# - executor: Minimal (1 tool) - process_run only
#   Use when sandbox lifecycle is managed externally, AI only executes commands
# - developer: Common dev tools (6 tools) - process_run + file operations
#   Use when AI needs to execute commands and manage files
# - full: All tools (14 tools) - sandbox + process + file operations
#   Use when AI needs full control over sandbox lifecycle
WORKSPACE_MCP_PROFILE=developer

# ============================================================================
# Logging
# ============================================================================

# Log level
RUST_LOG=info,workspace_server=debug
